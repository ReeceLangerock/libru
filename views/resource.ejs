<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<link rel="icon" href="./favicon.ico" type="image/x-icon"> -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <link href="../bower_components/bootstrap-star-rating/css/star-rating.min.css" media="all" rel="stylesheet" type="text/css" />
    <script src="../bower_components/bootstrap-star-rating/js/star-rating.min.js" type="text/javascript"></script>


</head>

<body>
    <!--import navbar -->
    <% if (isUserAuthenticated) { %>
    <%- include ./partials/authenticated-navigation.ejs %>
    <%  } else { %>
    <%- include ./partials/navigation.ejs %>
    <%  } %>
    <div class="container">
      <div class = "row">
        <div class = "col-md-3">
        <img class="img-responsive" src = "<%-resource.resourceImageURL%>"></img>
        <% if(isUserAuthenticated) { %>
        <form method="POST" action="/resource/change">
        <div class="form-group">

          <input type = "hidden" name = "resourceID" value = "<%=resource['_id']%>">
          <select onchange="this.form.submit()" class="custom-select mb-2 mr-sm-2 mb-sm-0" name = "resourceStatus" id="status-select">
            <option selected><%=resourseStatusForUser%></option>
            <option value="Completed">Completed</option>
            <option value="toDo">Want To Do</option>
            <option value="inProgress">In Progress</option>
          </select>
        </div>
      </form>
      <form method="POST" action="/resource/rate">
      <div class="form-group">
        <label for="resource-description">Rate It!</label>
        <input type = "hidden" name = "resourceID" value = "<%=resource['_id']%>">
        <input onchange="this.form.submit()" id="input-id" name="resourceRating" type="number" class="rating" value = "<%=resourceRatingForUser%>" min=0 max=5 step=1 data-size="md" data-rtl="false" data-show-clear="false" data-show-caption="false">
      </div>

      </form>
      <% } %>
    </div>

        <div class = "col-md-7">
        <div class = "Category">

        </div>
        <h1><%=resource.title%> <span class = "bg-primary"><%=resource.resourceCategory%></span></h1>


        <% var sum = 0; %>
        <% for(let i =0; i <resource.resourceRatings.length; i++) { %>
        <%  sum += resource.resourceRatings[i].rating; %>
        <% } %>
        <% var avg = sum / resource.resourceRatings.length; %>
        <span class = "ratingSpan"><h5>Avg. Rating: <%=avg %> | Total ratings: <%=resource.resourceRatings.length %></h5>
          <p><%=resource.resourceDescription%></>
          <p>Check it out <a href = "<%=resource.resourceURL%>">here</a></p>

        <hr>
        <dl class="dl-horizontal">
        <dt>Difficulty:</dt>
        <dd><%=resource.resourceDifficulty%></dd>
        <dt>Category:</dt>
        <% if(resource.resourceSubCategory == "none"){ %>
        <dd><%=resource.resourceCategory%></dd>
        <% } else { %>
        <dd><%=resource.resourceCategory%> - <%=resource.resourceSubCategory%></dd>
        <% } %>

        <dt>Cost:</dt>
        <dd><%=resource.resourceCost%></dd>
        <dt>Goes On Sale:</dt>
        <dd><%=resource.resourceGoesOnSale%></dd>

        <dt>Added On:</dt>
        <dd><%=resource.dateAdded%></dd>
        </dl>

        <hr>
        <form>
        <div class="form-group">
          <label for="comment">Leave a comment</label>
          <input type="text" class="form-control" name = "comment" id="comment">
        </div>
      </form>
        <h3>Recent Comments</h3>
        <% for(let i = 0; i < resource.resourceComments.length; i++ ){ %>
          <p><%=resource.resourceComments[i].comment%></p>
        <% } %>


      </div>

      <div class = "col-md-2">
        Placeholder Sidebar
      </div>

    </div>
    </div>


  </body>
  </html>
